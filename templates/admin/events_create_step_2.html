<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events</title>
    <!-- Подключение Bootstrap CSS -->
	<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Подключение Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="/static/css/style_events.css" />
</head>
<body>
  <div class="ec-desktop-event-create">
    {% include 'admin/sidebar.html' %}
    <form method="POST" action="/admin/events/create" enctype="multipart/form-data">
      <input type="hidden" name="step" value="step_2">
      <div class="ec-container-form">

        <div class="ec-row-view9">
          <button
            type="button"
            style="background:none;border:none;padding:0;margin:0;cursor:pointer;outline:none;"
            onclick="window.location.href='/admin/events/cancel'"
            aria-label="Назад"
          >
            <img src="/static/images/sidebar/left.svg" alt="Back" draggable="false" style="display:block;" />
          </button>
          <span class="text6">Create new event</span>
        </div>

        <div class="ec-date-block">
          <div class="ec-column7">
            <span class="ec-text7">Date and time</span>
            <div class="ec-column8">
              <div class="ec-row-view10">
                <div class="ec-date-col">
                  <span class="ec-text8">Start date</span>
                  <div class="ec-button-row-view">
                    <input
                      class="ec-text9"
                      id="start-date"
                      name="start_date"
                      type="date"
                      placeholder="Select date"
                      style="flex:1; background:#f3f3f3; border:none; border-radius:8px; font-size:16px;"
                    />
                     <img src="/static/images/sidebar/CalendarBlank.svg" class="ec-input-calendar" alt="calendar"
     onclick="EC_OPEN('start-date')" style="cursor:pointer; margin-left:-32px;">
                  </div>

                  <span class="ec-text8" style="margin-top:18px;">Start time</span>
                    <div class="ec-button-row-view">
                      <input
                        class="ec-text9"
                        id="start-time"
                        name="start_time"
                        type="time"
                        readonly
                        placeholder="Select time"
                        style="flex:1; background:#f3f3f3; border:none; border-radius:8px; font-size:16px;"
                      />
                      <img src="/static/images/alarm.svg" class="ec-input-calendar" alt="clock"
                           onclick="ET.openTimePicker(document.getElementById('start-time'))"
                           style="cursor:pointer; margin-left:-32px;" />
                    </div>
                </div>





                <div class="ec-date-col">
                  <span class="ec-text8">End date</span>
                  <div class="ec-button-row-view">
                    <input
                      class="ec-text9"
                      id="end-date"
                      name="end_date"
                      type="date"
                      placeholder="Select date"
                      style="flex:1; background:#f3f3f3; border:none; border-radius:8px; font-size:16px;"
                    />
                    <img src="/static/images/sidebar/CalendarBlank.svg" class="ec-input-calendar" alt="calendar"
     onclick="EC_OPEN('end-date')" style="cursor:pointer; margin-left:-32px;">
                  </div>

                  <div class="ec-view2">
                    <div class="ec-row-view12">
                      <label class="ec-styled-checkbox">
                        <input type="checkbox" name="free_entrance" id="same-checkbox">
                        <span class="checkmark"></span>
                        <span class="checkbox-label ec-text10">Same as a start date</span>
                      </label>
                    </div>
                  </div>

                  <span class="ec-text8" style="margin-top:8px;">End time</span>
                  <div class="ec-button-row-view">
                    <input
                      class="ec-text9"
                      id="end-time"
                      name="end_time"
                      type="time"
                      placeholder="Select time"
                      style="flex:1; background:#f3f3f3; border:none; border-radius:8px; font-size:16px;"
                    />
                    <img src="/static/images/alarm.svg" class="ec-input-calendar" alt="clock"
                           onclick="ET.openTimePicker(document.getElementById('end-time'))"
                           style="cursor:pointer; margin-left:-32px;" />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="ec-column7">
            <span class="ec-text7">Location</span>
            <div class="ec-column11">

              <div class="ec-input-block">
                <label class="ec-text8" for="venue-name">Venue name</label>
                <div class="ec-input-row">
                  <input
                    class="ec-input-field"
                    id="venue-name"
                    name="venue_name"
                    type="text"
                    maxlength="60"
                    placeholder="Enter name"
                    oninput="updateCharCount(this, '#venue-name-count', 60)"
                    autocomplete="off"
                  />
                  <div class="ec-input-info">
                    <span id="venue-name-count" class="ec-input-counter">0/60 characters</span>
<!--                    <img src="/static/images/sidebar/CalendarBlank.svg" class="ec-input-calendar" alt="calendar"/>-->
                  </div>
                </div>
              </div>

              <div class="ec-row-view10">
                <div class="ec-input-block">
                  <label class="ec-text8" for="venue-city">Venue city</label>
                  <div class="ec-input-row-2">
                    <input
                      class="ec-input-field"
                      id="venue-city"
                      name="venue_city"
                      type="text"
                      maxlength="60"
                      placeholder="Search city"
                      autocomplete="off"
                    />
                    <div class="ec-input-info">
<!--                      <img src="/static/images/sidebar/CalendarBlank.svg" class="ec-input-calendar" alt="calendar"/>-->
                    </div>
                  </div>
                </div>

                <div class="ec-row-view10">
                  <div class="ec-input-block">
                    <label class="ec-text8" for="venue-address">Venue address</label>
                    <div class="ec-input-row-2">
                      <input
                        class="ec-input-field"
                        id="venue-address"
                        name="venue_address"
                        type="text"
                        maxlength="60"
                        placeholder="Search address"
                        autocomplete="off"
                      />
                      <div class="ec-input-info">
<!--                        <img src="/static/images/sidebar/CalendarBlank.svg" class="ec-input-calendar" alt="calendar"/>-->
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="ec-form-actions">
            <div class="ec-progress-indicator">
              <span class="ec-step-text">2 of 3</span>
            </div>
            <div class="ec-button-row">
              <button class="btn btn-accent" type="button" onclick="window.location.href='/admin/events/cancel'">Cancel</button>
              <button class="btn btn-next-step">Next</button>
            </div>
          </div>

        </div>
      </div>
    </form>
  </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
	const input = document.getElementById('date-input');
input.addEventListener('focus', function() {
  this.placeholder = 'ДД.ММ.ГГГГ';
});
input.addEventListener('blur', function() {
  if (!this.value) this.placeholder = 'Select date';
});

function updateCharCount(input, counterSelector, max) {
  const val = input.value.length;
  document.querySelector(counterSelector).textContent = `${val}/${max} characters`;
}
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const checkbox = document.getElementById('same-checkbox');
  const startDate = document.getElementById('start-date');
  const endDate = document.getElementById('end-date');

  checkbox.addEventListener('change', function() {
    if (this.checked) {
      endDate.value = startDate.value;
      endDate.setAttribute('readonly', 'readonly');
    } else {
      endDate.removeAttribute('readonly');
      endDate.value = '';
    }
  });

  // Если дата старта поменялась и чекбокс активен — обновить конец
  startDate.addEventListener('change', function() {
    if (checkbox.checked) {
      endDate.value = startDate.value;
    }
  });
});
</script>
<script>
(function () {
  // Удобно хранить инстансы по id
  const pickers = new Map();

  function pad(n){ return String(n).padStart(2,'0'); }
  function toISO(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }

  function makeCalendar(input) {
    const wrap = input.closest('.ec-date-col') || input.parentElement;
    const cal = document.createElement('div');
    cal.className = 'ec-cal';
    cal.setAttribute('hidden','');

    // State
    const today = new Date();
    let selected = input.value ? new Date(input.value) : null;
    let view = selected ? new Date(selected) : new Date(today.getFullYear(), today.getMonth(), 1);

    // DOM
    cal.innerHTML = `
      <div class="ec-cal-head">
        <button type="button" class="ec-cal-btn prev" aria-label="Previous month"></button>
        <div class="ec-cal-title"></div>
        <button type="button" class="ec-cal-btn next" aria-label="Next month"></button>
      </div>
      <div class="ec-cal-week">
        <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
      </div>
      <div class="ec-cal-grid"></div>
    `;
    wrap.appendChild(cal);

    const titleEl = cal.querySelector('.ec-cal-title');
    const grid = cal.querySelector('.ec-cal-grid');

    function render() {
      // title
      const month = view.toLocaleString('en-US',{month:'long'});
      titleEl.textContent = `${month.charAt(0).toUpperCase()+month.slice(1)} ${view.getFullYear()}`;

      // grid
      grid.innerHTML = '';
      const first = new Date(view.getFullYear(), view.getMonth(), 1);
      const startIdx = first.getDay(); // Su=0
      const start = new Date(first); start.setDate(first.getDate() - startIdx);

      for (let i=0;i<42;i++){
        const d = new Date(start); d.setDate(start.getDate()+i);
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'ec-cal-day';
        btn.textContent = d.getDate();

        if (d.getMonth() !== view.getMonth()) btn.classList.add('is-out');
        if (selected && toISO(d) === toISO(selected)) btn.classList.add('is-selected');

        btn.addEventListener('click', () => {
          selected = new Date(d);
          input.value = toISO(selected);         // пишем в type="date" ISO строку
          input.dispatchEvent(new Event('change', {bubbles:true}));
          close();
        });

        grid.appendChild(btn);
      }
    }

    function open() {
      cal.removeAttribute('hidden');
      render();
      // закрытие при клике вне
      setTimeout(() => {
        document.addEventListener('mousedown', onDoc, { once:true });
        document.addEventListener('keydown', onEsc, { once:true });
      }, 0);
    }
    function close(){ cal.setAttribute('hidden',''); }
    function onDoc(e){
      if (!cal.contains(e.target)) close();
    }
    function onEsc(e){ if (e.key === 'Escape') close(); }

    // Навигация
    cal.querySelector('.prev').addEventListener('click', () => {
      view = new Date(view.getFullYear(), view.getMonth()-1, 1);
      render();
    });
    cal.querySelector('.next').addEventListener('click', () => {
      view = new Date(view.getFullYear(), view.getMonth()+1, 1);
      render();
    });

    // Публичные методы
    const api = { open, close, render };
    pickers.set(input.id, api);
    return api;
  }

  // API для иконки: EC_OPEN('end-date')
  window.EC_OPEN = function(id){
    const input = document.getElementById(id);
    if (!pickers.has(id)) makeCalendar(input);
    pickers.get(id).open();
  };

  // Авто-инициализация: открыть по клику на поле
  document.addEventListener('click', (e) => {
    const input = e.target.closest('input[type="date"].ec-text9');
    if (!input) return;
    e.preventDefault(); // чтобы не дергать нативный
    if (!pickers.has(input.id)) makeCalendar(input);
    pickers.get(input.id).open();
  });

})();
</script>
<script>
const ET = (()=> {
  const minuteStep = 1; // поставь 5 если нужны шаги по 5 минут
  let pop, sel = {h:0,m:0}, currentInput = null;

  function buildPopover(){
    pop = document.createElement('div');
    pop.className = 'ec-time-popover';
    pop.innerHTML = `
      <div class="ec-time-head" id="ec-time-head">00:00</div>
      <div class="ec-time-cols">
        <div class="ec-time-col" id="ec-col-h"></div>
        <div class="ec-time-col" id="ec-col-m"></div>
      </div>
      <div class="ec-time-footer">
        <button type="button" class="ec-time-ok ec--yellow" id="ec-time-ok">OK</button>
      </div>`;
    document.body.appendChild(pop);

    // события
    pop.addEventListener('click', e=>{
      const item = e.target.closest('.ec-time-opt');
      if(!item) return;
      const type = item.dataset.type;
      if(type==='h') sel.h = parseInt(item.dataset.val,10);
      if(type==='m') sel.m = parseInt(item.dataset.val,10);
      updateSelected();
    });

    document.getElementById('ec-time-ok').addEventListener('click', applyAndClose);
    document.addEventListener('keydown', e => { if(e.key==='Escape') close(); });
    document.addEventListener('mousedown', e => {
      if(pop && !pop.contains(e.target) && e.target !== currentInput) close();
    });
  }

  function fillLists(){
    const colH = document.getElementById('ec-col-h');
    const colM = document.getElementById('ec-col-m');
    colH.innerHTML = colM.innerHTML = '';
    for(let h=0; h<24; h++){
      colH.appendChild(opt(h,'h'));
    }
    for(let m=0; m<60; m+=minuteStep){
      colM.appendChild(opt(m,'m'));
    }
  }
  function opt(v,type){
    const d = document.createElement('div');
    d.className = 'ec-time-opt';
    d.dataset.type = type; d.dataset.val = v;
    d.textContent = String(v).padStart(2,'0');
    return d;
  }

  function parseInputValue(val){
    const m = /^(\d{1,2}):(\d{2})$/.exec(val || '');
    if(m){
      sel.h = Math.min(23, Math.max(0, +m[1]));
      sel.m = Math.min(59, Math.max(0, +m[2]));
    }else{
      const now = new Date();
      sel.h = now.getHours();
      sel.m = now.getMinutes() - (now.getMinutes()%minuteStep);
    }
  }

  function positionPopover(input){
    const r = input.getBoundingClientRect();
    pop.style.left = `${Math.round(window.scrollX + r.left)}px`;
    pop.style.top  = `${Math.round(window.scrollY + r.bottom + 8)}px`;
  }

  function updateHeader(){
    const hh = String(sel.h).padStart(2,'0');
    const mm = String(sel.m).padStart(2,'0');
    pop.querySelector('#ec-time-head').textContent = `${hh}:${mm}`;
  }

  function updateSelected(){
    pop.querySelectorAll('.ec-time-opt').forEach(el=>el.classList.remove('is-selected'));
    pop.querySelector(`.ec-time-opt[data-type="h"][data-val="${sel.h}"]`)?.classList.add('is-selected');
    pop.querySelector(`.ec-time-opt[data-type="m"][data-val="${sel.m}"]`)?.classList.add('is-selected');
    updateHeader();
  }

  function applyAndClose(){
    if(currentInput){
      currentInput.value = `${String(sel.h).padStart(2,'0')}:${String(sel.m).padStart(2,'0')}`;
      currentInput.dispatchEvent(new Event('change',{bubbles:true}));
    }
    close();
  }

  function openTimePicker(input){
    currentInput = input;
    if(!pop) { buildPopover(); fillLists(); }
    parseInputValue(input.value);
    updateSelected();
    positionPopover(input);
    pop.style.display = 'block';
  }

  function close(){
    if(pop) pop.style.display = 'none';
    currentInput = null;
  }

  // экспорт
  return { openTimePicker };
})();
</script>
</html>
